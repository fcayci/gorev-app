<form [formGroup]="gorevForm">
	<h2 mat-dialog-title>{{title}}</h2>

	<div class="form-row">
		<!-- name -->
		<mat-form-field  style="width:40%">
			<input matInput formControlName="description" placeholder="Görev Adı">
			<mat-hint align="end">Örn: ELM 000 vize gözetmenliği</mat-hint>
		</mat-form-field>

		<!-- <mat&#45;error *ngIf="gorevForm.hasError('required')"> -->
		<!-- 	Lütfen bir isim giriniz. -->
		<!-- </mat&#45;error> -->

		<!-- group -->
		<mat-form-field  style="width:35%">
			<mat-select formControlName="taskgroup" placeholder="Görev Türü">
				<mat-option *ngFor="let g of task_groups" [value]="g">
					{{[g]}}
				</mat-option>
			</mat-select>

			<!-- <mat&#45;error *ngIf="!gorevForm.hasError('group')"> -->
			<!-- 	Bir görev türü seçiniz. -->
			<!-- </mat&#45;error> -->
		</mat-form-field>

		<!-- weight -->
		<mat-form-field style="width:20%">
			<span matTooltip="Varsayılanı 1'dir. Görev süresiyle çarpılır.">
			<mat-select formControlName="weight" placeholder="Ağırlık">
				<mat-option *ngFor="let n of weights" [value]="n">
					{{[n]}}
				</mat-option>
			</mat-select>
			</span>

			<mat-hint align="end">Görev ağırlığı</mat-hint>
		</mat-form-field>
	</div>

	<div formGroupName="when">
		<div class="form-row">
			<!-- startday -->
			<mat-form-field class="date-align" style="width:35%">
				<input matInput formControlName="sday"
				[matDatepicker]="sday" placeholder="Tarih Seç">
					<mat-datepicker-toggle matSuffix [for]="sday">
					</mat-datepicker-toggle>
					<mat-datepicker #sday></mat-datepicker>
			</mat-form-field>

			<mat-error *ngIf="gorevForm.get('when').status.touched && !taskdate.valid"> -->
				Saat aralığı hatalı.
			</mat-error>

			<!-- starttime -->
			<mat-form-field style="width:20%">
				<input matInput formControlName="stime" type="time"
				placeholder="Başlangıç Saati">
			</mat-form-field>

			<!-- endtime -->
			<mat-form-field style="width:20%">
				<input matInput formControlName="etime" type="time"
				placeholder="Bitiş Saati">
			</mat-form-field>
		</div>
	</div>

	<div class="form-row">
		<!-- peoplecount -->
		<mat-form-field style="width:15%">
			<mat-select formControlName="peoplecount" placeholder="Kişi Sayısı">
				<mat-option *ngFor="let n of numbers" [value]="n">
					{{[n]}}
				</mat-option>
			</mat-select>

			<mat-error *ngIf="!gorevForm.hasError('peoplecount')">
				Görevlendirilecek kişi sayısı seçiniz.
			</mat-error>
		</mat-form-field>

		<div>
			<span matTooltip="Müsait olan Ar.Gör., Dr. veya bölümdeki tüm müsaitleri seçin.
			Müsait olmayanları da dahil etmek için Bölüm'ü işaretleyin.">
				<mat-button-toggle-group formControlName="sel">
					<mat-button-toggle value="1">Ar.Gör.</mat-button-toggle>
					<mat-button-toggle value="2">Dr.</mat-button-toggle>
					<mat-button-toggle value="3">Müsait</mat-button-toggle>
					<mat-button-toggle value="4">Bölüm</mat-button-toggle>
				</mat-button-toggle-group>
			</span>

		</div>

		<div>
			<button mat-button color="primary" (click)="autoAssignPeople()"
			[disabled]="!taskdate?.valid || !gorevForm.get('sel').value ||
			gorevForm.get('peoplecount').value === gorevForm.get('owners').length">
				Otomatik atama yap
			</button>
		</div>
	</div>

	<div class="form-row">
		<!-- selectedperson -->
		<mat-form-field  style="width:65%">
			<mat-select formControlName="selectedPerson" placeholder="Kişi Seç">

		<!-- <mat&#45;select formControlName="selectedPerson" placeholder="Kişi Seç"> -->
				<mat-option *ngFor="let c of (kadro |
				selector:gorevForm.value.sel)" [value]="c">
					<span style="margin-right: 4px; padding: 1px 5px;
					border-radius: 24px; background-color: #cecece">
						{{c.load}}
					</span>
					<span>
						-
					</span>
					<span>{{c.fullname}}</span>
				</mat-option>
			</mat-select>
		</mat-form-field>

		<div>
			<button mat-button color="primary" (click)="addToOwners()"
			[disabled]="gorevForm.get('when').status === 'INVALID' || !taskdate?.valid ||
			!gorevForm.get('selectedPerson').value ||
			gorevForm.get('peoplecount').value <= gorevForm.get('owners').length">
				Ekle
			</button>
		</div>

	</div>

	Atanan kisiler:
	<div class="form-row">
		<mat-chip-list class="mat-chip-list-stacked">
			<mat-chip *ngFor="let c of owners" [value]="c"
			(removed)="removeFromOwners(c)" >

				<mat-icon style="margin-left:0; margin-right:7px" matChipRemove>
					cancel
				</mat-icon>

				{{c.position + ' ' + c.fullname}}
				<span style="margin-left: 4px; padding: 1px 5px; border-radius: 24px;
				background-color: #a7a7a7">
					{{c.load}}
				</span>
			</mat-chip>
		</mat-chip-list>
	</div>

	<div class="button-row">
		<button mat-raised-button color="primary" (click)="onSubmit()"
		[disabled]="gorevForm.status === 'INVALID' || !taskdate.valid">
			Onayla & Bilgilendir
		</button>
	</div>

	{{gorevForm.value | json }}<br>
	{{gorevForm.status}}<br>
	{{ gorev | json }}
</form>
